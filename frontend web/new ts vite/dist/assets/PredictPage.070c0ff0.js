import{c as F,j as e,n as z,o as V,p as H,r as a,q as h,u as U,t as K,d as n,l as q,F as J,m as D,b as l,L as W}from"./index.23e8200d.js";import{t as Y,f as I,c as Q,p as X,S as Z,l as _,M as $}from"./ModelResultBox.46415888.js";import{F as ee}from"./index.esm.cf5ab2ec.js";import{a as te}from"./firebaseUse.82a610ed.js";import{D as oe}from"./DeleteModelBtn.646a7c2c.js";import{w as P,S as x}from"./sweetalert2-react-content.es.483ebece.js";import{B as L}from"./Button.6b16a52f.js";import{C as ae}from"./Container.531eb224.js";import{G as w,C as le}from"./Grid.d18f9fa4.js";import"./styled-components.browser.esm.ee9f42a4.js";const se=P(x);function ie({myModel:r,shortTitle:p}){const d=F();async function g(o,y){let c=await Y(o,y);if(c){let u=await z();d(V(u)),d(H())}const f=c?"success":"error",m=c?"Your model has been saved.":"Occur error while saving model.";se.fire({position:"top-end",icon:f,title:m,showConfirmButton:!1,timer:2e3})}return e(L,{color:"gray",onClick:async()=>g(r,p),children:" Save model "})}const T=P(x);let s;const ne={modeltitle:"",shortTitle:"",modeltype:"",iconName:"",bgColor:"",modelSubtitle:"",modelapiPath:"",modelShowStatus:!0,modelImagesUri:"",imageAlt:"",predictMode:"",online:!0,buttonDisable:!1,defaultThreshold:.4,labels:[],offlineInfo:{size:0,divValue:1,subVal:1,modelFunctionId:-1}};function be(){const[r,p]=a.exports.useState(I),[d,g]=a.exports.useState(),[o,y]=a.exports.useState(ne),[c,f]=a.exports.useState(!1),[m,u]=a.exports.useState({status:!0}),M=h(t=>t.counter.userData),N=h(t=>t.counter.userSetting),B=h(t=>t.counter.isGuest),S=h(t=>t.counter.offModelData),[j,v]=a.exports.useState(!1),O=U();let{mdName:k}=K();a.exports.useEffect(()=>{let t=S.filter(i=>i.modeltitle===o.modeltitle);v(t.length>=1)},[S]),a.exports.useEffect(()=>{(async()=>{if(document.title="Leafers - Predict",s=n.map(b=>b.shortTitle).indexOf(k||""),s<0)return;T.fire({title:"Model loading...",html:"Waiting for model load in, please wait.",timerProgressBar:!0,allowEscapeKey:!1,showCloseButton:!1,showCancelButton:!1,showConfirmButton:!1,allowOutsideClick:!1,didOpen:()=>{x.showLoading()}});const i=n[s].shortTitle,C=await q(i);y(n[s]);let G=C?"indexeddb://"+i:n[s].modelapiPath;v(C),R(G);async function R(b){let E=await Q(b,"GraphModel");T.close(),g(E)}})()},[]),a.exports.useEffect(()=>{(async()=>{if(r===I)return;f(!0),u({status:!0,top1:{label:"",confident:""},top2:{label:"",confident:""},top3:{label:"",confident:""},top4:{label:"",confident:""},top5:{label:"",confident:""},object:"",confident:"",timeTaken:"",timeTakenOffset:""});let t=await X(d,"img",o.offlineInfo.size,o.offlineInfo.subVal,o.offlineInfo.divValue,o.labels);const i={modelName:n[s].shortTitle,modelapiPath:n[s].modelapiPath,item:t.top1.label,confident:t.top1.confident*100,createAt:new Date};N.uploadHist&&M&&!B&&await te("users",M.uid,"predictHistory",i),parseInt(t.top1.confident)<o.defaultThreshold*100&&(t.object="Recognize unsuccess"),f(!1),u(t)})()},[r]);const A=t=>{!t||p(URL.createObjectURL(t))};return e(J,{children:e(D.div,{initial:{x:600,opacity:0},animate:{x:0,opacity:1},exit:{x:-600,opacity:0},transition:{duration:.5},children:e("div",{children:l(ae,{fluid:!0,children:[e(ee,{size:35,onClick:()=>O(-1)}),l("div",{style:{textAlign:"center"},children:[e("h1",{style:{textAlign:"center"},children:l("b",{children:["Input your pictures (",o.shortTitle,")"]})}),l(w,{className:"mt-4",children:[l(w.Col,{md:12,lg:6,className:"mb-4",children:[e(D.div,{whileHover:{scale:1.05},whileTap:{scale:.8},children:e("img",{id:"img",src:r,style:{width:"50%",height:"auto"},alt:"pics"})}),e("br",{}),e("label",{children:e("h3",{children:"Select image: "})})," ",e("div",{style:{display:"flex",justifyContent:"center"},children:e(Z,{handleChange:A,name:"file",types:["JPG","PNG"]})})]}),e(w.Col,{md:12,lg:6,children:l(le,{shadow:"lg",className:"mb-2",style:{borderRadius:"20px",textAlign:"center"},children:[e("h1",{children:"Informations"}),j?e(oe,{modelName:o.shortTitle}):e(ie,{myModel:d,shortTitle:o.shortTitle}),"  ",e(L,{color:"gray",onClick:async()=>_(o.labels),children:" Know more "}),c&&l("div",{children:[e(W,{color:"gray"}),e("h4",{children:"May take times for first time."})]}),m.status?e("div",{children:e($,{message:m})}):e("h1",{children:"Invalid input, please try again."}),l("h3",{style:{textAlign:"left"},children:["Target object (",o.labels.length,") "]}),e("br",{})]})})]})]})]})})})})}export{be as default};
